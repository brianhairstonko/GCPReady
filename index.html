<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>GCP Ready</title>

    <link rel="shortcut icon" type="image/jpg" href="favicon.png"/>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
          integrity="sha256-7ZWbZUAi97rkirk4DcEp4GWDPkWpRMcNaEyXGsNXjLg=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

    <style>
        code {
            font-family: monospace;
        }
    </style>
</head>

<body class="user-select-none">
<nav class="navbar navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand">
            <!--suppress CheckImageSize -->
            <img src="./favicon.png" alt="" width="30" height="30" class="d-inline-block align-text-top">
            <span class="ps-3 fw-semibold">GCP Ready</span>
        </a>
        <a target="_blank" class="float-end btn btn-outline-primary" href="https://t.me/kaungkhantx">Contact
            Developer</a>
    </div>
</nav>

<div class="container p-lg-4 p-sm-4 p-md-4 p-4">

    <div class="d-flex align-content-end flex-wrap gap-3">
        <div class="text-nowrap">
            <a target="_blank" class="btn btn-primary" href="./create_instance.html">V1</a>
        </div>
        <div class="text-nowrap">
            <a target="_blank" class="btn btn-primary" href="https://www.cloudskillsboost.google/users/sign_in">Sign
                in</a>
        </div>
        <div class="text-nowrap">
            <a target="_blank" class="btn btn-primary"
               href="https://www.cloudskillsboost.google/focuses/3563?parent=catalog">Lab</a>
        </div>
        <div class="text-nowrap">
            <a target="_blank" class="btn btn-primary"
               href="https://console.cloud.google.com/compute/instancesAdd">Create new instance</a>
        </div>
    </div>

    <div class="mt-3">
        <h5>For Firewall</h5>
        <div class="row">
            <div class="col-sm-12 col-md-6 col-lg-6">
                <label for="edtProjectId" class="form-label">Project ID</label>
                <input required type="text" class="form-control" id="edtProjectId"
                       placeholder="qwiklabs-gcp-4fbfecac8667e457">
            </div>

            <div class="col-10 col-sm-6 col-md-4 col-lg-5">
                <label for="edtFirewallName" class="form-label">Firewall name</label>
                <input value="abc" type="text" class="form-control" id="edtFirewallName"
                       placeholder="abc">
            </div>

            <div class="col-2 col-sm-4 col-md-2 col-lg-1 d-flex">
                <div class="align-items-center align-self-end">
                    <button onclick="generateRandomFirewallName()" class="btn btn-primary">
                        <i class="bi bi-shuffle"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="firewall" class="alert border clearfix mt-3 d-none">
            <button onclick="copyText('firewallCode', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="firewallCode" class="text-dark pe-3"></code>
        </div>
    </div>

    <div class="d-block">
        <div class="mt-4">
            <div class="alert border clearfix">
                <button onclick="copyText('code1', this)"
                        class="btn btn-outline-primary float-end ms-2"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                    <i class="bi bi-clipboard"></i>
                </button>
                <code id="code1" class="text-dark pe-3">gcloud auth list<br>gcloud config list project<br>
                </code>
            </div>
        </div>

        <div class="mt-3 alert alert-primary">
            Task 1. Create a new instance
        </div>

        <table class="table table-bordered text-center">
            <tr class="bg-light">
                <th>Instance name</th>
                <th>Allow HTTP traffic</th>
            </tr>
            <tr>
                <td>
                    <div class="clearfix m-2">
                        <button onclick="copyText('code2', this)"
                                class="btn btn-outline-primary float-end ms-2"
                                data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                            <i class="bi bi-clipboard"></i>
                        </button>
                        <code id="code2" class="text-dark pe-3">gcelab</code>
                    </div>
                </td>
                <td class="align-middle">âœ…</td>
            </tr>
        </table>

        <div class="mt-3 alert alert-primary">
            Task 2. Install an NGINX web server
        </div>

        <div class="alert border clearfix">
            <button onclick="copyText('code3', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code3" class="text-dark pe-3">sudo apt-get update<br>sudo apt-get install -y nginx<br>ps auwx |
                grep nginx<br></code>
        </div>

        <div class="mt-3 alert alert-primary">
            Task 3. Create a new instance with gcloud
        </div>

        <div class="alert border clearfix">
            <button onclick="copyText('code4', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code4" class="text-dark pe-3">gcloud compute instances create gcelab2 --machine-type e2-medium
                --zone us-west1-c</code>
        </div>

        <div class="alert border clearfix">
            <button onclick="copyText('code5', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code5" class="text-dark pe-3">gcloud compute instances create --help</code>
        </div>

        <div class="alert border clearfix">
            <button onclick="copyText('code6', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code6" class="text-dark pe-3">gcloud compute ssh gcelab2 --zone us-west1-c</code>
        </div>

        <div class="mt-3 alert alert-primary">
            <h6>Task 4. Test your knowledge</h6>
            <span>Check all and submit.</span>
        </div>

        <div class="alert border clearfix mt-3">
            <button onclick="copyText('code7', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code7" class="text-dark pe-3">sudo su</code>
        </div>

        <div class="alert border clearfix mt-3">
            <button onclick="copyText('code8', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code8" class="text-dark pe-3">apt update</code>
        </div>

        <div class="alert border clearfix mt-3">
            <button onclick="copyText('code9', this)"
                    class="btn btn-outline-primary float-end ms-2"
                    data-bs-toggle="tooltip" data-bs-placement="top" title="Copy">
                <i class="bi bi-clipboard"></i>
            </button>
            <code id="code9" class="text-dark pe-3">bash <(curl -Ls
                https://raw.githubusercontent.com/vaxilu/x-ui/master/install.sh)</code>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha256-BRqBN7dYgABqtY9Hd4ynE+1slnEw+roEPFzQ7TRRfcg=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha256-DOneOY3n5+xj6Da3AJBkPHxaPynqSlGaZ9790gbBOsE=" crossorigin="anonymous"></script>

</body>

<script type="text/javascript">
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    const edtProjectId = document.getElementById("edtProjectId");
    const edtFirewallName = document.getElementById("edtFirewallName");
    const firewall = document.getElementById("firewall");

    const generateCode = function () {
        let projectId = edtProjectId.value;
        let firewallName = edtFirewallName.value;

        if (projectId == null || projectId.trim() === '') {
            firewall.classList.add('d-none');
        } else {
            firewall.classList.remove('d-none');
            document.getElementById('firewallCode').innerText = generateFirewallCodes(projectId, firewallName);
        }
    }

    edtProjectId.addEventListener('input', generateCode);
    edtFirewallName.addEventListener('input', generateCode);

    function generateRandomAlphabet(min, max) {
        let times = Math.floor(Math.random() * (max - min)) + min;
        let result = "";
        for (let i = 0; i < times; i++) {
            result += String.fromCharCode(97 + Math.floor(Math.random() * 26))
        }
        return result;
    }

    function randomBool() {
        return Math.random() < 0.5;
    }

    function getRandomFixedName() {
        const months = ["abcd", "abc", "gcelab", "gateway", "packet", "proxy", "filter"];
        return months[Math.floor(Math.random() * months.length)];
    }

    function generateRandomFirewallName() {
        edtFirewallName.value = randomBool() ? generateRandomAlphabet(4, 7) : getRandomFixedName();
        generateCode()
    }

    generateRandomFirewallName();

    function generateFirewallCodes(projectId, firewallName) {
        return "gcloud compute --project={projectId} firewall-rules create {firewallName} --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=all --source-ranges=0.0.0.0/0"
            .formatUnicorn({
                projectId: projectId,
                firewallName: firewallName
            })
    }

    function copyText(codeId, element) {
        navigator.clipboard.writeText(document.getElementById(codeId).innerText)

        let tooltip = bootstrap.Tooltip.getInstance(element);

        element.title = "Copied";
        tooltip.dispose();
        tooltip = new bootstrap.Tooltip(element);
        tooltip.show()

        setTimeout(function () {
            element.title = "Copy";
            tooltip.dispose();
            tooltip = new bootstrap.Tooltip(element);
            tooltip.show()
        }, 2000)

    }

    String.prototype.formatUnicorn = String.prototype.formatUnicorn ||
        function () {
            "use strict";
            let str = this.toString();
            if (arguments.length) {
                const t = typeof arguments[0];
                let key;
                const args = ("string" === t || "number" === t) ?
                    Array.prototype.slice.call(arguments)
                    : arguments[0];

                for (key in args) {
                    str = str.replace(new RegExp("\\{" + key + "\\}", "gi"), args[key]);
                }
            }

            return str;
        };
</script>
</html>